<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Billetera Virtual - Iniciar Sesión</title>
  <!-- Import Darkly de Bootswatch -->
  <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/darkly/bootstrap.min.css" rel="stylesheet" />
  <!-- ImportFont Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <!-- CSS externo -->
  <link rel="stylesheet" href="./css/style.css">
</head>

<body>
  <div class="login-container">
    <img src="https://placehold.co/70x70/1a73e8/ffffff?text=CURS" alt="logo" class="logo" />
    <h1 class="text-center">FinTech App</h1>
    <p class="subtitle">La billetera virtual que te acompaña.</p>

    <div id="alertContainer"></div>

    <div id="loginForm">
      <h4 class="text-start">Inicio de sesión</h4>
      <div class="input-group mb-3">
        <span class="input-group-text"><i class="fas fa-envelope"></i></span>
        <input type="email" id="loginEmail" class="form-control" placeholder="Email" />
      </div>
      <div class="input-group mb-3">
        <span class="input-group-text"><i class="fas fa-lock"></i></span>
        <input type="password" id="loginContraseña" class="form-control" placeholder="Contraseña" />
      </div>
      <button class="btn btn-primary w-100" onclick="handleLogin()">
        <i class="fas fa-sign-in-alt"></i> Ingresar
      </button>
    </div>

    <p class="link-text">
      ¿No tienes cuenta? <a href="register.html">Regístrate aquí</a>
    </p>
  </div>


  <script>
    class Usuario {
      constructor(nombre, email, contraseña, saldo = 0) {
        this.nombre = nombre;
        this.email = email;
        this.contraseña = contraseña;
        this.saldo = saldo;
        this.movimientos = [];
      }
      //metodo Usuario
      ingresarDinero(monto) {
        if (monto > 0) {
          this.saldo += monto;
          this.movimientos.push(`Ingreso: +$${monto}`);
          return `Has ingresado $${monto}. Saldo actual: $${this.saldo}`;
        }
        return "Monto inválido";
      }
      transferirDinero(monto, destinatario) {
        if (monto > 0 && this.saldo >= monto) {
          this.saldo -= monto;
          destinatario.saldo += monto;
          this.movimientos.push(
            `Transferencia: -$${monto} a ${destinatario.email}`
          );
          destinatario.movimientos.push(
            `Transferencia: +$${monto} de ${this.email}`
          );
          return `Has transferido $${monto} a ${destinatario.email}`;
        }
        return "Fondos insuficientes o monto inválido";
      }
      verMovimientos() {
        return this.movimientos.length > 0 ?
          this.movimientos :
          "No hay movimientos";
      }
    }

    //Carga usuarios desde localStorage
    const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];

    function mostrarAlerta(mensaje, tipo) {
      const alertContainer = document.getElementById("alertContainer");
      alertContainer.innerHTML = `<div class="alert alert-${tipo} alert-dismissible fade show" role="alert">
                ${mensaje}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>`;
    }

    function handleLogin() {
      const email = document.getElementById("loginEmail").value;
      const contraseña = document.getElementById("loginContraseña").value;
      const user = login(email, contraseña);
      if (typeof user === "object") {
        //login es exitoso: guarda el usuario en sessionStorage
        sessionStorage.setItem("usuario", JSON.stringify(user));
        window.location.href = "transacciones.html";
      } else {
        mostrarAlerta(user, "danger");
      }
      //limpiar los campos
      document.getElementById("loginEmail").value = "";
      document.getElementById("loginContraseña").value = "";
    }

    function login(email, contraseña) {
      if (!email) {
        return "El email no puede estar vacío";
      }
      if (!contraseña) {
        return "La contraseña no puede estar vacía";
      }
      const user = usuarios.find(
        (u) => u.email === email && u.contraseña === contraseña
      );
      return user ? user : "Email o contraseña incorrectos";
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>